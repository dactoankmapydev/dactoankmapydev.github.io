<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Thu thập dữ liệu với Scrapy, Splash, Lua - Nội dung được tạo bởi Javascript &mdash; Save and Share</title>
  <meta name="author" content="Nguyen Dac Toan KMA">






  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="/favicon.png" rel="icon">

  <link href="/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="/">Save and Share</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li class="active">
        <a href="/category/crawl.html">Crawl</a>
      </li>
      <li >
        <a href="/category/data-analysis.html">Data analysis</a>
      </li>
      <li >
        <a href="/category/web-application.html">Web application</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Thu thập dữ liệu với Scrapy, Splash, Lua - Nội dung được tạo bởi Javascript</h1>
    <p class="meta">
<time datetime="2019-01-29T17:14:42.463168+07:00" pubdate>T3 29 Tháng một 2019</time>    </p>
</header>

  <div class="entry-content"><p><a href="https://github.com/dactoankmapydev/Crawler_Web_Js">Source</a> </p>
<ul>
<li>Thật khó để tìm thấy một trang web hiện đại không sử dụng công nghệ javascript. Khi bạn muốn lấy nội dung được tạo bằng javascript từ một trang web, bạn sẽ nhận ra rằng Scrapy đơn thuần không thể chạy mã javascript trong khi thu thập dữ liệu. Trong bài viết này, mình sẽ  hướng dẫn các bạn cách thu thập dữ liệu từ trang <a href="https://websosanh.vn/">websosanh</a>, websosanh là công cụ tìm kiếm, so sánh giúp người tiêu dùng mua được sản phẩm tốt với giá rẻ nhất tại nơi bán gần nhất.</li>
</ul>
<h1>Quét nội dung được tạo bằng javascript</h1>
<h2>Kiểm tra nội dung nào trên trang web sử dụng javascript</h2>
<ul>
<li>Khi bạn ghé thăm một trang web để thu thập dữ liệu. Bạn sẽ làm gì? Trước tiên, bạn nên kiểm tra trang web đó trong trình duyệt của bạn với <a href="https://chrome.google.com/webstore/detail/quick-javascript-switcher/geddoclleiomckbhadiaipdggiiccfje">Quick Javascript Switcher</a> là một tiện ích mở rộng của Chrome cho phép bạn kích hoạt hoặc vô hiệu hóa javaScript của trang web một cách nhanh chóng, nhờ đó bạn có thể dễ dàng kiểm tra xem các nội dung nào của trang web sử dụng javascript. Nếu bạn muốn vượt qua javaScript để tiếp cận dữ liệu bạn muốn, bạn có thể tham khảo 3 giải pháp dưới đây</li>
</ul>
<h2>Requests-HTML</h2>
<ul>
<li>Nếu bạn đã từng sử dụng <a href="http://docs.python-requests.org/en/master/">Requests</a> mô-đun cho python trước đây, gần đây nhà phát triển đã tạo ra một mô-đun mới có tên gọi <a href="https://html.python-requests.org/">Requests-HTML</a> mà giờ đây cũng có khả năng hiển thị javaScript, giải pháp này chỉ dành cho phiên bản 3.6 của Python (tại thời điểm này). Bạn cũng có thể truy cập <a href="http://docs.python-requests.org/en/master/">Requests</a> để tìm hiểu thêm về mô-đun này hoặc nếu bạn chỉ quan tâm đến việc hiển thị javaScript thì bạn có thể truy cập <a href="https://html.python-requests.org/">Requests-HTML</a> để trực tiếp tìm hiểu cách sử dụng mô-đun để  hiển thị javaScript bằng Python.</li>
</ul>
<h2>Selenium</h2>
<ul>
<li><a href="https://selenium-python.readthedocs.io/">Selenium</a> là trình duyệt web không có giao diện đồ họa người dùng. Vì vậy, bạn có thể điều khiển trình duyệt thông qua giao diện API hoặc dòng lệnh. Các trình duyệt phổ biến như mozilla và chrome có trình điều khiển web chính thức của riêng họ . Các trình duyệt này có thể tải javaScript để bạn có thể sử dụng chúng trong trình cạo web của mình.</li>
</ul>
<h2>Splash</h2>
<ul>
<li><a href="https://splash.readthedocs.io/en/stable/api.html">Splash</a> cung cấp một công cụ để hiển thị mã javaScript cho khung trình thu thập thông tin Scrapy. Nó có các chức năng sau:</li>
</ul>
<div class="highlight"><pre><span></span>    Return a good HTML page for the user

    Concurrent rendering multiple pages

    Turn off the picture load, speed up the rendering

    Executing user – defined JS code

    Implementing user defined Lua footsteps is similar to non interface browser phantomjs. 
</pre></div>


<h2>Đánh giá các giải pháp</h2>
<ul>
<li>
<p><a href="https://html.python-requests.org/">Requests-HTML</a> khá tốt và mới mẻ , tuy nhiên giải pháp này chỉ dành cho phiên bản 3.6 của Python (tại thời điểm này), tài liệu tham khảo tương đối ít.</p>
</li>
<li>
<p>Khi bạn chọn giữa hai lựa chọn <a href="https://selenium-python.readthedocs.io/">Selenium</a> và <a href="https://splash.readthedocs.io/en/stable/api.html">Splash</a> cho dự án cạo web của mình, bạn nên xem xét một yếu tố: yêu cầu tài nguyên phần cứng. <strong>Selenium</strong> tiêu thụ tài nguyên hệ thống nhiều hơn khi tạo ra hàng ngàn requests trong khi chạy. Mình không khuyến khích bạn sử dụng <strong>Selenium</strong> cho các dự án cạo web. Thay vào đó bạn nên thử  <strong>Splash</strong>. Nó được tạo để chỉ hiển thị nội dung javaScript. Đây chính xác là những gì bạn cần cho việc cạo web. </p>
</li>
</ul>
<h1>Thực hành</h1>
<h2>Mục tiêu</h2>
<ul>
<li>Thu thập thông tin về <strong>tên</strong>, <strong>giá thành</strong>, <strong>ảnh</strong> của sản phẩm bất kỳ nằm trong <strong>danh mục sản phẩm</strong>. Trong bài viết này, mình sẽ demo việc lấy dữ liệu từ danh mục <a href="https://websosanh.vn/dan-organ/cat-2022.htm">đàn organ</a></li>
</ul>
<p><img alt="Image" src="images/categori.png"></p>
<h2>Phân tích</h2>
<ul>
<li>Trước tiên, mình sử dụng <a href="https://chrome.google.com/webstore/detail/quick-javascript-switcher/geddoclleiomckbhadiaipdggiiccfje">Quick Javascript Switcher</a> để kiểm tra xem các thành phần nào của trang web có sử dụng javascript bằng cách tắt <a href="https://chrome.google.com/webstore/detail/quick-javascript-switcher/geddoclleiomckbhadiaipdggiiccfje">Quick Javascript Switcher</a>, ngay sau hành động đó các hình ảnh về sản phẩm đồng loạt biến mất như trong hình ảnh bên dưới </li>
</ul>
<p><img alt="Image" src="images/no-js.png"></p>
<ul>
<li>Như vậy <strong>ảnh sản phẩm</strong> được tạo bởi javascript</li>
<li>Một điều cần chú ý tiếp theo là trang web sử dụng phân trang. Phân trang là kỹ thuật phổ biến được các nhà phát triển web sử dụng để hiển thị lượng dữ liệu lớn trong kết quả tìm kiếm hoặc danh sách thay vì đặt tất cả các sản phẩm được liệt kê trên cùng một trang, vì vậy nếu bạn muốn thu thập dữ liệu sản phẩm từ trang web, bạn cần cấu hình tác vụ thu thập dữ liệu của mình với phân trang để có thể lấy được tất cả các sản phẩm được liệt kê trên các trang khác nhau.</li>
</ul>
<h2>Còn tiếp...</h2></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Nguyen Dac Toan KMA
    </span>
  </span>
<time datetime="2019-01-29T17:14:42.463168+07:00" pubdate>T3 29 Tháng một 2019</time>  <span class="categories">
    <a class='category' href='/category/crawl.html'>Crawl</a>
  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="/scrapy.html">Thu thập dữ liệu với Scrapy, Splash, Lua - Nội dung được tạo bởi Javascript</a>
      </li>
      <li class="post">
          <a href="/sosanhviec.html">Ứng dụng web SO SÁNH VIỆC</a>
      </li>
      <li class="post">
          <a href="/pytudi.html">Từ điển trực tuyến Anh-Việt, Việt-Anh</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="/category/crawl.html">Crawl</a></li>
        <li><a href="/category/data-analysis.html">Data analysis</a></li>
        <li><a href="/category/web-application.html">Web application</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="https://github.com/dactoankmapydev" target="_blank">Github</a></li>
            <li><a href="https://www.facebook.com/toan.nguyen.31392410" target="_blank">Facebook</a></li>
            <li><a href="https://www.linkedin.com/in/dac-toan-nguyen-a94b2a146/" target="_blank">Linkedin</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2019  Nguyen Dac Toan KMA &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="/theme/js/modernizr-2.0.js"></script>
  <script src="/theme/js/ender.js"></script>
  <script src="/theme/js/octopress.js" type="text/javascript"></script>
</body>
</html>